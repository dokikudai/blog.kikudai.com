box: debian
build:
  steps:
    - arjen/hugo-build:
        version: "0.17"
        theme: angels-ladder
        flags: --buildDrafts=true
deploy:
  steps:
    - s3sync:
      key-id: $AWS_ACCESS_KEY_ID
      key-secret: $AWS_SECRET_ACCESS_KEY
      bucket-url: $AWS_S3_BUCKET
      source-dir: $SOURCE
      opts: --encoding=utf-8
  after-steps:
    - edgecaseadmin/install-aws-cli:
      key: $AWS_ACCESS_KEY_ID
      secret: $AWS_SECRET_ACCESS_KEY
      region: $AWS_REGION
    - script:
      name: amazonS3-redirect-rule
      code: |-
        aws s3api put-object --bucket blog.kikudai.com --key archives/tag/wordpress/index.html --website-redirect-location 'http://blog.kikudai.com/tags/wordpress'